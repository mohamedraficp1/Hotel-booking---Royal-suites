<link href="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
<script src="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script>

<div class="breadcrumb-option set-bg" data-setbg="user/img/breadcrumb-bg.jpg">
        <div class="container mb-5">
            <div class="row">
                <div class="col-lg-12 text-center">
                    <div class="breadcrumb__text">
                        <h1>Our Room</h1>
                        <div class="breadcrumb__links">
                            <a href="./index.html">Home</a>
                            <span>Rooms</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Rooms Section End -->
    <section class="container">
  <div class="d-flex justify-content-between align-items-center my-5">
    <div class="d-flex flex-row align-items-center">

      <a href="/roomDetails?id={{roomDetails.0.rooms.roomId}}" style="text-decoration:none;"> <span class="ms-2 me-3 text-danger">
          < Modify your booking</span></a>
    </div>
   
  </div>

  <div class="row ">
    <div class="col-xs-12 col-md-7 col-lg-7 col-xl-6 mb-4 mb-md-0 ">

      <div class="border d-flex align-items-center justify-content-center"
        style="height: 10%; background-color: #0059ff16;border-color: #0059ff3a;"><span class="text-primary">ðŸŽ‰ Yay! you
          just
          saved <b>â‚¹ {{searchDetails.savedPrice}}</b> on this booking!</span></div>
      <div class="mt-5 col-auto border container-fluid" style="padding: 0 25px; !important">
        <div class="form-control-lg " style="background-color: #f9f9fb;"><span
            class="detailsHead text-dark font-weight-bold">Enter your
            details</span></div>
        <form class="mt-3 " method="post" action="/confirmBook" >
          <div class="row ms-3 me-3">
            <div class="col ">
              <label for="name" class="font-weight-bold">Full Name</label>
              <input type="text" id="name" class="form-control" {{#if profileName}} value="{{profileName}}" disabled
                {{/if}}name="name" placeholder="Full name">
            </div>
            <div class="col">
              <label for="email" class="font-weight-bold">Email</label>
              <input type="email" class="form-control" id="email" {{#if emailId}}value="{{emailId}}" disabled
                {{/if}} name="email" placeholder="abc@gmail.com">
            </div>
          </div>
          <div class="d-flex justify-content-center mb-3">
            <h4 id="imageErr"> </h4>
            <div>
                <button class="btn btn-success my-4" type="submit">Continue</button></div>
          </div>
        </form>
      </div>
    </div>
    <div class="col-xs-12 col-md-5 col-lg-4 col-xl-4 offset-lg-1 offset-xl-2">
      <form id="bookNow">
        <div class="p-3 border" style="background-color: rgba(238, 238, 238, 0.459);">
          <div class="d-flex justify-content-between"><span class="fw-bold mt-2">{{roomData.[0].rooms.roomName}}</span>
            <div style="width: 8rem;height: 5rem;"><img
                src="/images/room-images/{{roomData.[0].rooms.img.[0].filename}}"
                class="border border-dark"></div>
          </div>
          <div class="d-flex justify-content-between mt-2">
            <span></span> <span></span>
          </div>
          <div class="d-flex flex-column mt-2">
            <div class="font-weight-bold bookNowReceiptFonts"><i class="fa-regular fa-calendar-days text-secondary">
              </i>
              {{searchData.checkIn}}-{{searchData.checkOut}}</div>
            <div class="font-weight-bold bookNowReceiptFonts "><i class="bi bi-bookmark-check"></i>
              {{searchData.rooms}} rooms,{{searchData.guest}}
              Guests</div>
          </div>
          <div class="d-flex justify-content-between mt-4">
            <span class="font-weight-bold bookNowReceiptFonts "><i class='bx bx-door-open text-secondary'></i>
              {{roomData.[0].rooms.category}}</span> <span class="font-weight-bold bookNowReceiptFonts">â‚¹
              {{roomData.[0].rooms.price}}</span>
          </div>
          <div class="d-flex justify-content-between mt-2">
            <span></span> <span></span>
          </div>
          <hr />
          {{!-- <div class="d-flex justify-content-between mt-2">
            <span class="lh-sm bookNowReceiptFonts">Room for {{searchDetails.days}} night X {{searchDetails.room}} Rooms
            </span>
            <span class="bookNowReceiptFonts font-weight-bold">{{searchDetails.amount}}</span>
          </div> --}}
          <div class="d-flex justify-content-between mt-3">
            <span class="lh-sm bookNowReceiptFonts">Subtotal ({{roomDetails.0.rooms.offer}}%)</span>
            <span class="bookNowReceiptFonts font-weight-bold">â‚¹ {{subtotal}}</span>
          </div>
          <div class="d-flex justify-content-between mt-3">
            <span class="lh-sm bookNowReceiptFonts">Tax ({{roomDetails.0.rooms.offer}}%)</span>
            <span class="bookNowReceiptFonts font-weight-bold">â‚¹ {{tax}}</span>
          </div>
          <hr />
          <div class="d-flex justify-content-between mt-2">
            <span class="bookNowReceiptFonts"></span> <span class="bookNowReceiptFonts font-weight-bold"></span>
          </div>
          <div class="d-flex justify-content-between mt-2">
            <span></span> <span></span>
          </div>
          <hr />
          <div class="d-flex justify-content-between mt-2">
            <span>Total </span> <span class="text-success"><b>â‚¹ {{totalAmount}}</b></span>
          </div>
          <div class="btn-group mt-3 d-flex justify-content-center">

          </div>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="options" id="option1" autocomplete="off" value="hotel">
            <label class="form-check-label" for="flexRadioDefault1">
              Pay at Hotel
            </label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="options" id="option2" autocomplete="off" value="online"
              >
            <label class="form-check-label" for="flexRadioDefault1">
              Online Payment
            </label>
          </div>
          <div class="col d-flex justify-content-center mt-1 mb-5">
           

            <button type="submit" id="payNow" class="btn btn-success btn-lg disabled mt-1"
              >Pay Now</button>
          </div>
        </div>
      </form>

    </div>

  </div>
</section>

<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<script>

const $form = $('#bookNow')
$form.on('submit', submitHandler)

function submitHandler (e) {
  e.preventDefault()

   $.ajax({
        url: '/pay-now',   
        method: "post",
        data: $form.serialize(),
        success:(response)=>{
          alert(response)
          alert(response.id)
          console.log(response)
          console.log(response.id)
          /*if(response.status){
            location.href='/order-success'
          }
          else{
            raorpayPayment(response)
          }*/
          raorpayPayment(response)
        }

    }).done(response => {
    console.log(response)
  })
}

function raorpayPayment(order){
  
  var options = {
    "key": "rzp_test_CeMgXyfbISX6hs", // Enter the Key ID generated from the Dashboard
    "amount": {{totalAmount}}, // Amount is in currency subunits. Default currency is INR. Hence, 50000 refers to 50000 paise
    "currency": "INR",
    "name": "Royal Suites",
    "description": "Book your room",
    "image": "https://example.com/your_logo",
    "order_id": order.id, //This is a sample Order ID. Pass the `id` obtained in the response of Step 1
    "handler": function (response){
        alert(response.razorpay_payment_id);
        alert(response.razorpay_order_id);
        alert(response.razorpay_signature)
        verifyPayement(response,order)
    },
    "prefill": {
        "name": "Gaurav Kumar",
        "email": "gaurav.kumar@example.com",
        "contact": "9999999999"
    },
    "notes": {
        "address": "Royal Suites"
    },
    "theme": {
        "color": "#3399cc"
    }
};
var rzp1 = new Razorpay(options);
rzp1.open();
}


function verifyPayement(payment,order) {
  $.ajax({
    url:'/verify-payment',
    data:{
      payment,
      order
    },
    method:'post'
  })
}

  </script>

       
