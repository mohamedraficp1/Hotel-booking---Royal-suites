<link href="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
<script src="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script>

<div class="breadcrumb-option set-bg" data-setbg="user/img/breadcrumb-bg.jpg">
        <div class="container mb-5">
            <div class="row">
                <div class="col-lg-12 text-center">
                    <div class="breadcrumb__text">
                        <h1>Our Room</h1>
                        <div class="breadcrumb__links">
                            <a href="./index.html">Home</a>
                            <span>Rooms</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Rooms Section End -->
    <section class="container" id="roombooking-details">
  <div class="d-flex justify-content-between align-items-center my-5">
    <div class="d-flex flex-row align-items-center">

      <a href="/roomDetails?id={{roomDetails.0.rooms.roomId}}" style="text-decoration:none;"> <span class="ms-2 me-3 text-danger">
          < Modify your booking</span></a>
    </div>
   
  </div>

  <div class="row ">
    <div class="col-xs-12 col-md-7 col-lg-7 col-xl-6 mb-4 mb-md-0 ">

      <div class="border d-flex align-items-center justify-content-center"
        style="height: 10%; background-color: #0059ff16;border-color: #0059ff3a;"><span class="text-primary">ðŸŽ‰ Yay! you
          just
          saved <b>â‚¹ {{searchDetails.savedPrice}}</b> on this booking!</span></div>
           {{#if profileName}}
      <div class="mt-5 col-auto border container-fluid" style="padding: 0 25px; !important">
        <div class="form-control-lg " style="background-color: #f9f9fb;"><span
            class="detailsHead text-dark font-weight-bold">Enter your
            details</span></div>
        <form class="mt-3 " id="booking-continue" >
          <div class="row ms-3 me-3">
            <div class="col ">
              <label for="name" class="font-weight-bold">Full Name</label>
              <input type="text" id="profileName" class="form-control" value="{{profileName}}" disabled
               name="name" placeholder="Full name">
            </div>
            <div class="col">
              <label for="email" class="font-weight-bold">Email</label>
              <input type="email" class="form-control" id="email"value="{{emailId}}" disabled
                name="email" placeholder="abc@gmail.com">
            </div>
          </div>
          <div class="d-flex justify-content-center mb-3">
            <h4 id="imageErr"> </h4>
            <div>
                <button class="btn btn-success my-4" type="submit">Continue</button></div>
          </div>
        </form>
      </div>
      {{else}}
       <div class="mt-5 col-auto border container-fluid" style="padding: 0 25px; !important">
        <div class="form-control-lg " style="background-color: #f9f9fb;"><span
            class="detailsHead text-dark font-weight-bold">Login to continue</span></div>
        <form  id="user-login-booking" >
          <div class="row ms-3 me-3">
            <div class="col ">
              <label for="name" class="font-weight-bold">Email</label>
              <input type="email" id="typeEmailX-2" minlength="6" required name="email" placeholder="email" class="form-control form-control-lg">
            </div>
            <div class="col">
              <label for="email" class="font-weight-bold">Password</label>
              <input type="password" name="password" required minlength="4" placeholder="Password" id="typePasswordX-2" class="form-control form-control-lg">
            </div>
          </div>
          <div class="d-flex justify-content-center mb-3">
            <h4 id="imageErr"> </h4>
            <div>
                <button class="btn btn-success my-4" type="submit">Login</button></div>
          </div>
        </form>
      </div>
         {{/if}}
    </div>
    <div class="col-xs-12 col-md-5 col-lg-4 col-xl-4 offset-lg-1 offset-xl-2">
      <form id="bookNow">
        <div class="p-3 border" style="background-color: rgba(238, 238, 238, 0.459);">
          <div class="d-flex justify-content-between"><span class="fw-bold mt-2">{{roomData.[0].rooms.roomName}}</span>
            <div style="width: 8rem;height: 5rem;"><img
                src="/images/room-images/{{roomData.[0].rooms.img.[0].filename}}"
                class="border border-dark"></div>
          </div>
          <div class="d-flex justify-content-between mt-2">
            <span></span> <span></span>
          </div>
          <div class="d-flex flex-column mt-2">
            <div class="font-weight-bold bookNowReceiptFonts"><i class="fa-regular fa-calendar-days text-secondary">
              </i>
              {{searchData.checkIn}}-{{searchData.checkOut}}</div>
            <div class="font-weight-bold bookNowReceiptFonts "><i class="bi bi-bookmark-check"></i>
              {{searchData.rooms}} rooms,{{searchData.guest}}
              Guests</div>
          </div>
          <div class="d-flex justify-content-between mt-4">
            <span class="font-weight-bold bookNowReceiptFonts "><i class='bx bx-door-open text-secondary'></i>
              {{roomData.[0].rooms.category}}</span> <span class="font-weight-bold bookNowReceiptFonts">â‚¹
              {{roomData.[0].rooms.price}}</span>
          </div>
          <div class="d-flex justify-content-between mt-2">
            <span></span> <span></span>
          </div>
          <hr />
          {{!-- <div class="d-flex justify-content-between mt-2">
            <span class="lh-sm bookNowReceiptFonts">Room for {{searchDetails.days}} night X {{searchDetails.room}} Rooms
            </span>
            <span class="bookNowReceiptFonts font-weight-bold">{{searchDetails.amount}}</span>
          </div> --}}
          <div class="d-flex justify-content-between mt-3">
            <span class="lh-sm bookNowReceiptFonts">Subtotal ({{roomDetails.0.rooms.offer}}%)</span>
            <span class="bookNowReceiptFonts font-weight-bold">â‚¹ {{subtotal}}</span>
          </div>
          <div class="d-flex justify-content-between mt-3">
            <span class="lh-sm bookNowReceiptFonts">Tax ({{roomDetails.0.rooms.offer}}%)</span>
            <span class="bookNowReceiptFonts font-weight-bold">â‚¹ {{tax}}</span>
          </div>
          <hr />
          <div class="d-flex justify-content-between mt-2">
            <span class="bookNowReceiptFonts"></span> <span class="bookNowReceiptFonts font-weight-bold"></span>
          </div>
          <div class="d-flex justify-content-between mt-2">
            <span></span> <span></span>
          </div>
          <hr />
          <div class="d-flex justify-content-between mt-2">
            <span>Total </span> <span class="text-success"><b>â‚¹ {{totalAmount}}</b></span>
          </div>
          <div class="btn-group mt-3 d-flex justify-content-center">

          </div>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="options" id="option1" autocomplete="off" value="hotel">
            <label class="form-check-label" for="flexRadioDefault1">
              Pay at Hotel
            </label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="options" id="option2" autocomplete="off" value="online"
              >
            <label class="form-check-label" for="flexRadioDefault1">
              Online Payment
            </label>
          </div>
          <div class="col d-flex justify-content-center mt-1 mb-5">
           

            <button type="submit" id="payNow" class="btn btn-success btn-lg disabled mt-1"
              >Pay Now</button>
          </div>
        </div>
      </form>

    </div>

  </div>
</section>
 <script src=
"https://cdnjs.cloudflare.com/ajax/libs/sweetalert/2.1.0/sweetalert.min.js">
  </script>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<script>

const $contineForm =$('#booking-continue')
$contineForm.on('submit', submitionHandler)

function submitionHandler (e) {
  e.preventDefault()

   $.ajax({
        url: '/confirmBook',   
        method: "post",
        data: $contineForm.serialize(),
            success:(status)=>{
          if(status){
            swal("Succesfully completed booking", "Please complete payment", "success")
             $('#bookNow').load(location.href + " #bookNow");
          }
        }

    }).done(response => {
    console.log(response)
  })
}



const $loginform = $('#user-login-booking')
$loginform.on('submit', submitHandlers)

function submitHandlers (e) {
  e.preventDefault()

   $.ajax({
        url: '/booking-login',   
        method: "post",
        data: $loginform.serialize(),
         success: (responses) => {
            if (responses) {
                $(document).ajaxStop(function(){
    window.location.reload();
});
            }
        }

    }).done(response => {
    console.log(response)
  })
}


const $form = $('#bookNow')
$form.on('submit', submitHandler)

function submitHandler (e) {
  e.preventDefault()

   $.ajax({
        url: '/pay-now',   
        method: "post",
        data: $form.serialize(),
        success:(response)=>{
          alert(response)
          alert(response.id)
          console.log(response)
          console.log(response.id)
          if(response.hotel){
            location.href='/thank-you'
          }
          else{
            raorpayPayment(response)
          }
        }

    }).done(response => {
    console.log(response)
  })
}

function raorpayPayment(order){
  
  var options = {
    "key": "rzp_test_CeMgXyfbISX6hs", // Enter the Key ID generated from the Dashboard
    "amount": {{totalAmount}}, // Amount is in currency subunits. Default currency is INR. Hence, 50000 refers to 50000 paise
    "currency": "INR",
    "name": "Royal Suites..",
    "description": "Book your room",
    "image": "https://example.com/your_logo",
    "order_id": order.id, //This is a sample Order ID. Pass the `id` obtained in the response of Step 1
    "handler": function (response){
        verifyPayement(response,order)
    },
    "prefill": {
        "name": "Royal Suites",
        "email": "info@bon-voyage.com",
        "contact": "9895676767"
    },
    "notes": {
        "address": "Royal Suites"
    },
    "theme": {
        "color": "#3399cc"
    }
};
var rzp1 = new Razorpay(options);
rzp1.open();
}


function verifyPayement(payment,order) {
  $.ajax({
    url:'/verify-payment',
    data:{
      payment,
      order
    },
    method:'post',
    success:(response)=>{
         if(response.status){
           console.log('hai',response.status)
           location.href ='/thank-you'
         }
        
        }
  })
}

  </script>

       
